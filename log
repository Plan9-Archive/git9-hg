#!/bin/rc -e

rfork en

base=/n/git/object/
branch=$1
if(~ $1 '')
	branch='master'
if(! test -e /n/git/ctl)
	git/fs

commits=($branch)
if(test -e /n/git/branch/heads/$branch)
	commits=`{cat /n/git/branch/heads/$branch/hash}
if not if(test -e /n/git/branch/$branch)
	commits=`{cat /n/git/branch/$branch/hash}
if not if(test -e /n/git/object/$branch/hash)
	commits=`{cat /n/git/object/$branch/hash}
if not{
	echo 'unknown commit '$branch >[2=1]
	exit 'unknown commit '$branch
}

while(! ~$#commits 0){
	c=$commits(1)
	echo 'Hash:	' `{cat $base/$c/hash}
	echo 'Author:	' `{cat $base/$c/author}
	cat $base/$c/msg | sed 's/^/	/g'
	echo ''

	commits=($commits(2-) `{cat $base/$c/parent})
	echo $commits
	if(! ~$#commits 0)
		commits=`{du -t $base^$commits | sort -rn | awk -F/ '{print $NF}'}
}
