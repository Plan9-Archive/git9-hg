#!/bin/rc -e

rfork e

base=/n/git/object/
branch=$1
if(~ $1 '')
	branch='master'
commits=($branch)
if(test -e /n/git/branch/heads/$1)
	commits=`{cat /n/git/branch/heads/$1/hash}
if not if(test -e /n/git/branch/$1)
	commits=`{cat /n/git/branch/$1/hash}
if not if(test -e /n/git/object/$1/hash)
	commits=`{cat /n/git/object/$1/hash}
if not{
	[2=1] echo 'unknown commit '$1
	exit 'unknown commit '$1
}


while(! ~$#commits 0){
	c=$commits(1)
	echo 'Hash:	' `{cat $base/$c/hash}
	echo 'Author:	' `{cat $base/$c/author}
	cat $base/$c/msg | sed 's/^/	/g'
	echo ''

	commits=($commits(2-) `{cat $base/$c/parent})
	echo $commits
	if(! ~$#commits 0)
		commits=`{du -t $base^$commits | sort -rn | awk -F/ '{print $NF}'}
}
