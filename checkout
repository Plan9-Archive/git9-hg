#!/bin/rc -e

rfork en

if(! cd `{git/conf -r}){
	echo 'not a git repository' >[1=2]
	exit notgit
}
git/fs

files=$*
pfx=`{git/conf -p}
if(~ $#* 0)
	files=`{git/walk | awk '{print $2}'}

git/fs
files=$files
tree=/mnt/git/HEAD/tree
rm -rf .git/index9/^$files
rm -f $files
for(f in $files){
	rel=`{sed 's@^'$tree'/*@@' <{echo $f}}
	if(~ $#rel 0)
		rel=''
	idx=.git/index9/tracked/$rel
	mkdir -p `{basename -d $f}
	mkdir -p `{basename -d $idx}
	touch $idx
	cp $tree/$f $f
}
